<Window x:Class="DatabaseExampleWPF.SearchLoansWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="View and Search Loans" 
        Height="700" 
        Width="1100"
        WindowStartupLocation="CenterScreen">

    <!-- 
    This window demonstrates:
    - JOIN queries to display data from multiple tables
    - Search/filter functionality using LIKE operator
    - Read-only display of joined data
    - Using the LoanWithDetails view model class
    - Displaying computed properties (Status, StatusMessage)
    
    This is different from LoansWindow which manages individual Loans.
    This window is for VIEWING loans with full details from Books and Members tables.
    -->

    <Window.Resources>
        <!-- Button style -->
        <Style TargetType="Button">
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>

        <!-- TextBlock style -->
        <Style TargetType="TextBlock">
            <Setter Property="Margin" Value="5"/>
            <Setter Property="FontSize" Value="12"/>
        </Style>

        <!-- TextBox style -->
        <Style TargetType="TextBox">
            <Setter Property="Padding" Value="5"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="FontSize" Value="12"/>
        </Style>
    </Window.Resources>

    <!-- Main Grid -->
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Header section -->
            <RowDefinition Height="Auto"/>
            <!-- Search section -->
            <RowDefinition Height="Auto"/>
            <!-- Filter buttons -->
            <RowDefinition Height="*"/>
            <!-- DataGrid -->
            <RowDefinition Height="Auto"/>
            <!-- Details section -->
        </Grid.RowDefinitions>

        <!-- Header Section -->
        <Border Grid.Row="0" 
                Background="#F44336" 
                Padding="15"
                Margin="0,0,0,10">
            <StackPanel>
                <TextBlock Text="View All Loans with Details" 
                           FontSize="20" 
                           FontWeight="Bold"
                           Foreground="White"
                           HorizontalAlignment="Center"/>

                <TextBlock Text="Demonstrates JOIN queries across Loans, Books, and Members tables" 
                           FontSize="12"
                           Foreground="White"
                           HorizontalAlignment="Center"
                           Margin="0,5,0,0"/>
            </StackPanel>
        </Border>

        <!-- Search Section -->
        <Border Grid.Row="1" 
                Background="White" 
                BorderBrush="#DDDDDD"
                BorderThickness="1"
                Padding="10"
                Margin="0,0,0,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Search label -->
                <TextBlock Grid.Column="0" 
                           Text="🔍 Search:" 
                           VerticalAlignment="Center"
                           FontWeight="SemiBold"/>

                <!-- 
                Search TextBox
                User can type book title or member name to filter results
                -->
                <TextBox Grid.Column="1"
                         x:Name="txtSearch"
                         Margin="5"
                         VerticalContentAlignment="Center"/>

                <!-- Search button -->
                <Button Grid.Column="2"
                        x:Name="btnSearch"
                        Content="Search"
                        Click="BtnSearch_Click"
                        Background="#2196F3"
                        Foreground="White"
                        Width="100"/>

                <!-- Clear search button -->
                <Button Grid.Column="3"
                        x:Name="btnClearSearch"
                        Content="Show All"
                        Click="BtnClearSearch_Click"
                        Background="#4CAF50"
                        Foreground="White"
                        Width="100"/>
            </Grid>
        </Border>

        <!-- Filter Buttons Section -->
        <StackPanel Grid.Row="2" 
                    Orientation="Horizontal"
                    HorizontalAlignment="Center"
                    Margin="0,0,0,10">

            <TextBlock Text="Quick Filters:" 
                       VerticalAlignment="Center"
                       FontWeight="SemiBold"
                       Margin="0,0,10,0"/>

            <Button x:Name="btnShowAll"
                    Content="📚 All Loans"
                    Click="BtnShowAll_Click"
                    Background="#9E9E9E"
                    Foreground="White"/>

            <Button x:Name="btnShowActive"
                    Content="📖 Active Loans"
                    Click="BtnShowActive_Click"
                    Background="#2196F3"
                    Foreground="White"/>

            <Button x:Name="btnShowOverdue"
                    Content="⚠️ Overdue Loans"
                    Click="BtnShowOverdue_Click"
                    Background="#F44336"
                    Foreground="White"/>

            <Button x:Name="btnShowReturned"
                    Content="✅ Returned Loans"
                    Click="BtnShowReturned_Click"
                    Background="#4CAF50"
                    Foreground="White"/>
        </StackPanel>

        <!-- 
        DataGrid for displaying joined loan data
        This demonstrates displaying data from a JOIN query
        The ItemsSource will be set to List<LoanWithDetails>
        -->
        <Border Grid.Row="3"
                BorderBrush="#DDDDDD"
                BorderThickness="1">

            <DataGrid x:Name="dgLoansWithDetails"
                      AutoGenerateColumns="False"
                      IsReadOnly="True"
                      SelectionMode="Single"
                      CanUserAddRows="False"
                      CanUserDeleteRows="False"
                      GridLinesVisibility="Horizontal"
                      AlternatingRowBackground="#F5F5F5"
                      SelectionChanged="DgLoansWithDetails_SelectionChanged">

                <!-- 
                Define columns to show data from the JOIN query
                Each column binds to a property of LoanWithDetails
                -->
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Loan ID" 
                                        Binding="{Binding LoanID}" 
                                        Width="70"/>

                    <!-- Book information (from Books table via JOIN) -->
                    <DataGridTextColumn Header="Book Title" 
                                        Binding="{Binding BookTitle}" 
                                        Width="*"/>

                    <DataGridTextColumn Header="ISBN" 
                                        Binding="{Binding BookISBN}" 
                                        Width="110"/>

                    <!-- Member information (from Members table via JOIN) -->
                    <DataGridTextColumn Header="Member Name" 
                                        Binding="{Binding MemberFullName}" 
                                        Width="150"/>

                    <DataGridTextColumn Header="Member Type" 
                                        Binding="{Binding MemberType}" 
                                        Width="100"/>

                    <!-- Loan dates -->
                    <DataGridTextColumn Header="Loan Date" 
                                        Binding="{Binding LoanDate, StringFormat='dd/MM/yyyy'}" 
                                        Width="90"/>

                    <DataGridTextColumn Header="Due Date" 
                                        Binding="{Binding DueDate, StringFormat='dd/MM/yyyy'}" 
                                        Width="90"/>

                    <DataGridTextColumn Header="Return Date" 
                                        Binding="{Binding ReturnDate, StringFormat='dd/MM/yyyy'}" 
                                        Width="95"/>

                    <!-- 
                    Status column - computed property from LoanWithDetails
                    Shows: "Returned", "On Loan", or "OVERDUE"
                    -->
                    <DataGridTextColumn Header="Status" 
                                        Binding="{Binding Status}" 
                                        Width="90"/>
                </DataGrid.Columns>

                <!-- 
                Row Style - change background color based on status
                This demonstrates conditional formatting in DataGrid
                -->
                <DataGrid.RowStyle>
                    <Style TargetType="DataGridRow">
                        <!-- 
                        DataTrigger: Changes style based on data value
                        If IsOverdue property is True, set red background
                        -->
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsOverdue}" Value="True">
                                <Setter Property="Background" Value="#FFEBEE"/>
                                <!-- Light red background for overdue -->
                                <Setter Property="Foreground" Value="#C62828"/>
                                <!-- Dark red text -->
                            </DataTrigger>

                            <DataTrigger Binding="{Binding IsReturned}" Value="True">
                                <Setter Property="Background" Value="#E8F5E9"/>
                                <!-- Light green background for returned -->
                                <Setter Property="Foreground" Value="#2E7D32"/>
                                <!-- Dark green text -->
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </DataGrid.RowStyle>
            </DataGrid>
        </Border>

        <!-- Details Section (shows details of selected loan) -->
        <Border Grid.Row="4" 
                Background="White" 
                BorderBrush="#DDDDDD"
                BorderThickness="1"
                Padding="15"
                Margin="0,10,0,0">

            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Selected Loan Details - Column 1 -->
                <StackPanel Grid.Column="0" Margin="0,0,10,0">
                    <TextBlock Text="Selected Loan Details" 
                               FontWeight="Bold"
                               FontSize="14"
                               Margin="0,0,0,10"/>

                    <TextBlock x:Name="txtLoanDetails"
                               Text="Select a loan to view details"
                               TextWrapping="Wrap"
                               FontStyle="Italic"
                               Foreground="Gray"/>
                </StackPanel>

                <!-- Book Details - Column 2 -->
                <StackPanel Grid.Column="1" Margin="10,0,10,0">
                    <TextBlock Text="Book Information" 
                               FontWeight="Bold"
                               FontSize="14"
                               Margin="0,0,0,10"/>

                    <TextBlock x:Name="txtBookDetails"
                               Text="Select a loan to view book details"
                               TextWrapping="Wrap"
                               FontStyle="Italic"
                               Foreground="Gray"/>
                </StackPanel>

                <!-- Member Details - Column 3 -->
                <StackPanel Grid.Column="2" Margin="10,0,0,0">
                    <TextBlock Text="Member Information" 
                               FontWeight="Bold"
                               FontSize="14"
                               Margin="0,0,0,10"/>

                    <TextBlock x:Name="txtMemberDetails"
                               Text="Select a loan to view member details"
                               TextWrapping="Wrap"
                               FontStyle="Italic"
                               Foreground="Gray"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>